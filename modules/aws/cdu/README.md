<!-- BEGIN_TF_DOCS -->
## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= v1.3.9 |
| <a name="requirement_aws"></a> [aws](#requirement\_aws) | >= 4.56.0 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_aws"></a> [aws](#provider\_aws) | 4.56.0 |

## Modules

| Name | Source | Version |
|------|--------|---------|
| <a name="module_cdu_efs"></a> [cdu\_efs](#module\_cdu\_efs) | github.com/aws-samples/aws-tf-efs//modules/aws/efs | v1.0.0 |
| <a name="module_cdu_kms"></a> [cdu\_kms](#module\_cdu\_kms) | github.com/aws-samples/aws-tf-kms//modules/aws/kms | v1.0.0 |

## Resources

| Name | Type |
|------|------|
| [aws_autoscaling_group.cdu_asg](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/autoscaling_group) | resource |
| [aws_cloudwatch_log_group.cdu_logs](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudwatch_log_group) | resource |
| [aws_iam_instance_profile.cdu_node_role](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_instance_profile) | resource |
| [aws_iam_role.cdu_node_role](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role) | resource |
| [aws_iam_role_policy_attachment.cdu_node_role](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role_policy_attachment) | resource |
| [aws_launch_template.cdu_lt](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/launch_template) | resource |
| [aws_lb.cdu_nlb](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lb) | resource |
| [aws_lb_listener.cdu_listener](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lb_listener) | resource |
| [aws_lb_target_group.cdu_tg](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lb_target_group) | resource |
| [aws_route53_record.cdu_rec_ipv4](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/route53_record) | resource |
| [aws_route53_record.cdu_rec_ipv6](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/route53_record) | resource |
| [aws_s3_object.cdu_extra_file](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_object) | resource |
| [aws_s3_object.cdu_extra_files](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_object) | resource |
| [aws_s3_object.required_file](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_object) | resource |
| [aws_security_group.cdu_sg](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group) | resource |
| [aws_security_group_rule.allow_cdu_ingress_to_efs](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group_rule) | resource |
| [aws_security_group_rule.egress_cdu_sg](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group_rule) | resource |
| [aws_security_group_rule.ingress_cdu_sg](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group_rule) | resource |
| [aws_ssm_parameter.cert_password](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ssm_parameter) | resource |
| [aws_ssm_parameter.keystore_password](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ssm_parameter) | resource |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_cdu_params"></a> [cdu\_params](#input\_cdu\_params) | Connect:Direct Unix Node Parameters.<br>- `node_name`, required. Name of the C:D node. e.g. "USLDCDUC01"<br>- `s3_bucket`, required. Amazon S3 bucket name used for storing C:D Unix installation/config files. It may be same as the Terraform bootstrap bucket.<br>- `cd_bin`, optional. IBM Connect:Direct installation file. Default "IBM\_CD\_V6.2\_UNIX\_RedHat.Z.tar.Z"<br>- `secret_key_prefix`, optional. System Manager Parameter Store key prefix used to store `cdu_secrets`. Default "/`project`/`env_name`/cdu"<br>- `server_keycert`, optional. Name of the server keycert file. Default "`lower(node_name)`.cdu-keycert.txt"<br>- `root_cert`, optional. Name of the root certificate file. Default "ca-cert.cer"<br>- `issuing_cert`, optional. Name of the issuer certificate file. Default "issuer-cert.cer"<br>- `netmap_file`, optional. Name of the `netmap` file (e.g. "netmap\_a.cfg") in the "./`node_name`" folder. Default ""<br>- `users_file`, optional. Name of the `userfile` file (e.g. "userfile\_a.cfg") in the "./`node_name`" folder. Default ""<br>- `global_folder`, optional. Global folder where C:D installation will be linked to. Default "/opt/IBM/ConnectDirect"<br>- `local_folder`, optional. Local folder where C:D installation will be linked to. Default "/home/cdadmin"<br>- `cdadmin_uid`, optional. POSIX UID for the cdadmin user. Default 2001<br>- `cdadmin_gid`, optional.POSIX GID for the cdadmin user. Default 2001<br>- `overwrite`, optional. Should existing installing be overwritten "Y" or "N". Default "Y"<br>  If any of the `cdu_params` are changed, then `overwrite` should be "Y" for the changes to take effect.<br>- `cw_log_group`, optional. Amazon CloudWatch log group where C:D server logs will be sent. Default "/`project`/`env_name`/cdu/`node_name`"<br>- `proxy_url`, optional. Proxy server URL, if your environment is using proxy server. Default `"NONE"` | <pre>object({<br>    node_name         = string<br>    s3_bucket         = string<br>    cd_bin            = optional(string)<br>    secret_key_prefix = optional(string)<br>    server_keycert    = optional(string)<br>    root_cert         = optional(string)<br>    issuing_cert      = optional(string)<br>    netmap_file       = optional(string)<br>    users_file        = optional(string)<br>    global_folder     = optional(string)<br>    local_folder      = optional(string)<br>    cdadmin_uid       = optional(number)<br>    cdadmin_gid       = optional(number)<br>    overwrite         = optional(string)<br>    cw_log_group      = optional(string)<br>    proxy_url         = optional(string)<br>  })</pre> | n/a | yes |
| <a name="input_env_name"></a> [env\_name](#input\_env\_name) | Environment name e.g. dev, prod | `string` | n/a | yes |
| <a name="input_project"></a> [project](#input\_project) | Project name (prefix/suffix) to be used on all the resources identification | `string` | n/a | yes |
| <a name="input_region"></a> [region](#input\_region) | The AWS Region e.g. us-east-1 for the environment | `string` | n/a | yes |
| <a name="input_subnet_tags"></a> [subnet\_tags](#input\_subnet\_tags) | Tags to discover target subnets in the VPC, these tags should identify one or more subnets | `map(string)` | n/a | yes |
| <a name="input_tags"></a> [tags](#input\_tags) | Common and mandatory tags for the resources | `map(string)` | n/a | yes |
| <a name="input_vpc_tags"></a> [vpc\_tags](#input\_vpc\_tags) | Tags to discover target VPC, these tags should uniquely identify a VPC | `map(string)` | n/a | yes |
| <a name="input_cdu_efs_specs"></a> [cdu\_efs\_specs](#input\_cdu\_efs\_specs) | Connect:Direct Unix EFS storage specification.<br>If null, the installation will not be HA and resilient as the C:D Unix server will use EBS.<br>- `efs_id`, required. File System ID of EFS.<br>  if null, new EFS will be created.<br>- `efs_root`, required. Path on EFS where C:D Unix will be installed.<br>  If null or empty "/`project`/`env_name`/cdu" will be assumed.<br>- `security_group_tags`, required. Tags to discover an existing security group for the new EFS. These tags should uniquely identify a security group.<br>  if null, new Security Group will be created.<br>  Must be provided if `efs_id` is not null<br>- `encrypted`, required. Should EFS be encrypted? Not applicable if `efs_id` is provided<br>- `kms_alias`, required. Use the given alias or create a new KMS like "alias/`project`/efs".<br>  Not applicable if `efs_id` is provided | <pre>object({<br>    efs_id              = string<br>    efs_root            = string<br>    security_group_tags = map(string)<br>    encrypted           = bool<br>    kms_alias           = string<br>  })</pre> | <pre>{<br>  "efs_id": null,<br>  "efs_root": null,<br>  "encrypted": true,<br>  "kms_alias": null,<br>  "security_group_tags": null<br>}</pre> | no |
| <a name="input_cdu_encryption"></a> [cdu\_encryption](#input\_cdu\_encryption) | Connect:Direct Unix solution encryption specification<br>- `encrypted`, required. Should the EBS, CW logs and SSM be encrypted.<br>- `ebs_kms_alias`, required. Use the given alias or create a new KMS like "alias/`project`/ebs" for encrypting EBS.<br>  Not applicable if `encrypted` is false.<br>- `logs_kms_alias`, required. Use the given alias or create a new KMS like "alias/`project`/logs" for encrypting CW logs.<br>  Not applicable if `encrypted` is false.<br>- `ssm_kms_alias`, required. Use the given alias or create a new KMS like "alias/`project`/ssm" for encrypting SSM.<br>  Not applicable if `encrypted` is false. | <pre>object({<br>    encrypted      = bool<br>    ebs_kms_alias  = string<br>    logs_kms_alias = string<br>    ssm_kms_alias  = string<br>  })</pre> | <pre>{<br>  "ebs_kms_alias": "",<br>  "encrypted": true,<br>  "logs_kms_alias": "",<br>  "ssm_kms_alias": ""<br>}</pre> | no |
| <a name="input_cdu_extra_files"></a> [cdu\_extra\_files](#input\_cdu\_extra\_files) | List of Connect:Direct Unix extra files that will be copied over to IBM C:D Unix server. These files may be tokenized files, where tokens will be replaced.<br>- `tokens`, required. List of tokens with `name` and `value`. These tokens can be used in the `files`.<br>- `files`, required. List of files with `source` and `target` that will be copied over to IBM C:D Unix server.<br>- `files.source`, required. Name of the file in the "./`node_name`" folder. e.g. "test-l.cd"<br>- `files.target`, required. Full path on the C:D Unix server where file will be copied (must include file name). e.g. "/home/cdadmin/cdunix/ndm/bin/test-l.cd" | <pre>object({<br>    tokens = list(object({<br>      name  = string<br>      value = string<br>    }))<br>    files = list(object({<br>      source = string<br>      target = string<br>    }))<br>  })</pre> | `null` | no |
| <a name="input_cdu_host_specs"></a> [cdu\_host\_specs](#input\_cdu\_host\_specs) | Connect:Direct Unix Host specification.<br>- `image_id`, required. Provide image\_id of the AMI to use.<br>  if null or empty, a suitable public AMI will be used.<br>- `instance_type`, required. Provide Amazon EC2 instance type e.g. "t2.micro"<br>- `ec2_instance_profile`, required. Provide IAM instance profile that C:D Unix host will assume.<br>  If null or empty, a new role and instance profile will be created.<br>- `ssh_key_name`, required. Provide name of an existing key pair, if you want to connect to the host via ssh.<br>  Host can always be accessed via SSM.<br>- `enable_detailed_monitoring`, required. Should the detailed monitoring for the host be enabled.<br>- `backup_plan`, required. AWS Backup service well-known tag for backup. e.g. "EVERY-DAY"<br>  This is applicable if AWS Backup service is being used for the backup. | <pre>object({<br>    image_id                   = string<br>    instance_type              = string<br>    ec2_instance_profile       = string<br>    ssh_key_name               = string<br>    enable_detailed_monitoring = bool<br>    backup_plan                = string<br>  })</pre> | <pre>{<br>  "backup_plan": "",<br>  "ec2_instance_profile": "",<br>  "enable_detailed_monitoring": false,<br>  "image_id": "",<br>  "instance_type": "m5.large",<br>  "ssh_key_name": ""<br>}</pre> | no |
| <a name="input_cdu_ingress"></a> [cdu\_ingress](#input\_cdu\_ingress) | Connect:Direct Unix ingress specifications.<br>- `source_cidrs`, required. List of source CIDRs that required access to C:D Unix, most probably on-premises CIDRs. e.g. ["10.1.0.0/16", "10.2.0.0/16"]<br>- `ingress_ports`, required. List Ingress ports on which C:D Unix is providing inbound connections. e.g. [1363,1364,1365] | <pre>object({<br>    source_cidrs  = list(string)<br>    ingress_ports = list(string)<br>  })</pre> | <pre>{<br>  "ingress_ports": [<br>    "1363",<br>    "1364",<br>    "1365"<br>  ],<br>  "source_cidrs": [<br>    "0.0.0.0/0"<br>  ]<br>}</pre> | no |
| <a name="input_cdu_lb_target_ports"></a> [cdu\_lb\_target\_ports](#input\_cdu\_lb\_target\_ports) | Connect:Direct Unix Load-Balancer target(s) specifications.<br>At least one target port is required to create load-balancer. Otherwise load-balancer will not be created.<br>- `purpose`, required. Purpose for the LB target e.g. "cli", "comm", or "fa"<br>- `protocol`, required. Backend protocol where CDU host is listening for this `purpose`. e.g. "tcp"<br>- `port`, required. Backend port where CDU host is listening for this `purpose`. e.g. 1363, 1364, or 1365<br>- `deregistration_delay`, required. The time to wait for in-flight requests to complete while de-registering a target. e.g. 300<br>- `preserve_client_ip`, required. Preserve client IP addresses and ports in the packets forwarded to targets. e.g. true<br>- `hc_protocol`, required. Health check protocol e.g. "TCP"<br>- `hc_port`, required. The port the LB uses when performing health checks on target. e.g. 1365<br>- `hc_interval`, required. Time between health checks of an individual target. e.g. 30<br>- `hc_healthy_threshold`, required. The number of consecutive health checks successes required before considering an unhealthy target healthy. e.g. 3<br>- `hc_unhealthy_threshold`, required. The number of consecutive health check failures required before considering a target unhealthy. e.g. 3 | <pre>list(object({<br>    purpose                = string<br>    protocol               = string<br>    port                   = number<br>    deregistration_delay   = number<br>    preserve_client_ip     = bool<br>    hc_protocol            = string<br>    hc_port                = number<br>    hc_interval            = number<br>    hc_healthy_threshold   = number<br>    hc_unhealthy_threshold = number<br>  }))</pre> | <pre>[<br>  {<br>    "deregistration_delay": 300,<br>    "hc_healthy_threshold": 3,<br>    "hc_interval": 30,<br>    "hc_port": 1365,<br>    "hc_protocol": "TCP",<br>    "hc_unhealthy_threshold": 3,<br>    "port": 1363,<br>    "preserve_client_ip": true,<br>    "protocol": "TCP",<br>    "purpose": "cli"<br>  },<br>  {<br>    "deregistration_delay": 300,<br>    "hc_healthy_threshold": 3,<br>    "hc_interval": 30,<br>    "hc_port": 1365,<br>    "hc_protocol": "TCP",<br>    "hc_unhealthy_threshold": 3,<br>    "port": 1364,<br>    "preserve_client_ip": true,<br>    "protocol": "TCP",<br>    "purpose": "comm"<br>  },<br>  {<br>    "deregistration_delay": 300,<br>    "hc_healthy_threshold": 3,<br>    "hc_interval": 30,<br>    "hc_port": 1365,<br>    "hc_protocol": "TCP",<br>    "hc_unhealthy_threshold": 3,<br>    "port": 1365,<br>    "preserve_client_ip": true,<br>    "protocol": "TCP",<br>    "purpose": "fa"<br>  }<br>]</pre> | no |
| <a name="input_cdu_secrets"></a> [cdu\_secrets](#input\_cdu\_secrets) | Connect:Direct Unix Secrets. These secrets are created in the System Manager Parameter Store.<br>These are seed secrets and can/must change after creation.<br>It is encouraged to create these secrets outside the Terraform.<br>- `cert_password`, required. it is the password that is used to create the encrypted server private key.<br>- `keystore_password`, required. it is the password that is used to protect the keystore on the server. | <pre>object({<br>    cert_password     = string<br>    keystore_password = string<br>  })</pre> | `null` | no |
| <a name="input_enable_dual_stack"></a> [enable\_dual\_stack](#input\_enable\_dual\_stack) | Enable Dual Stack IPV4/IPV6 for the C:D Unix server and load-balancer. This is experimental. | `bool` | `false` | no |
| <a name="input_kms_admin_roles"></a> [kms\_admin\_roles](#input\_kms\_admin\_roles) | List Administrator roles for KMS.<br>Provide at least one Admin role if kms needs to be created for EBS, EFS, CW Logs or SSM<br>e.g. ["Admin"] | `list(string)` | `[]` | no |
| <a name="input_r53_zone_name"></a> [r53\_zone\_name](#input\_r53\_zone\_name) | Route 53 Zone basename | `string` | `""` | no |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_cdu_ami"></a> [cdu\_ami](#output\_cdu\_ami) | AMI for C:D Unix Instance |
| <a name="output_cdu_autoscaling_group"></a> [cdu\_autoscaling\_group](#output\_cdu\_autoscaling\_group) | Autoscaling group for C:D Unix |
| <a name="output_cdu_cw_log_group"></a> [cdu\_cw\_log\_group](#output\_cdu\_cw\_log\_group) | CloudWatch log group for C:D Unix |
| <a name="output_cdu_efs_root"></a> [cdu\_efs\_root](#output\_cdu\_efs\_root) | CDU root folder on EFS/EBS |
| <a name="output_cdu_instance_profile"></a> [cdu\_instance\_profile](#output\_cdu\_instance\_profile) | Instance Profile for the CDU instance |
| <a name="output_cdu_kms"></a> [cdu\_kms](#output\_cdu\_kms) | Outputs from KMS module |
| <a name="output_cdu_launch_template_id"></a> [cdu\_launch\_template\_id](#output\_cdu\_launch\_template\_id) | Id for the Launch Template for C:D Unix |
| <a name="output_cdu_launch_template_version"></a> [cdu\_launch\_template\_version](#output\_cdu\_launch\_template\_version) | Version of the Launch Template for C:D Unix |
| <a name="output_cdu_nlb_dns"></a> [cdu\_nlb\_dns](#output\_cdu\_nlb\_dns) | NLB DNS for C:D Unix |
| <a name="output_cdu_r53_fqdn"></a> [cdu\_r53\_fqdn](#output\_cdu\_r53\_fqdn) | Route 53 FQDN for C:D Unix |
| <a name="output_cdu_security_group"></a> [cdu\_security\_group](#output\_cdu\_security\_group) | Security Group for the CDU instance |
| <a name="output_cdu_target_groups"></a> [cdu\_target\_groups](#output\_cdu\_target\_groups) | Target Groups for C:D Unix |
| <a name="output_efs_id"></a> [efs\_id](#output\_efs\_id) | Elastic File System info |
<!-- END_TF_DOCS -->
